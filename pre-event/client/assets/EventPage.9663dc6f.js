import{t as T}from"./TicketsService.3ed44814.js";import{_ as D,a,b as t,t as _,k as v,F as I,r as E,w as V,m as B,v as F,d as A,E as L,n as N,o as P,q as u,P as d,e as h,l as m,A as l,s as f,f as r,u as U,p as j,h as M,i as R,x as q}from"./index.70f62ba1.js";const b={name:"Event",components:{EventForm:L},setup(){const s=U(),c=N({});async function w(){try{await h.getEventById(s.params.eventId)}catch(n){m.error("[getting event by id]",n),d.error(n)}}async function e(){try{await h.getTickets(s.params.eventId)}catch(n){m.error("[getting event tickets]",n),d.error(n)}}async function k(){try{await h.getComments(s.params.eventId)}catch(n){m.error("[getting event comments]",n),d.error(n)}}return P(()=>{w(),k(),e()}),{editable:c,hasTicket:u(()=>!!l.tickets.find(n=>{var i;return n.accountId==((i=l.account)==null?void 0:i.id)})),event:u(()=>l.activeEvent),cover:u(()=>{var n;return`url(${((n=l.activeEvent)==null?void 0:n.coverImg)||"https://i.pinimg.com/originals/b5/94/6e/b5946e195cdff505e697a8dad43ae5fe.jpg"})`}),tickets:u(()=>l.tickets),comments:u(()=>l.comments),account:u(()=>l.account),async cancelEvent(n){try{if(!await d.confirm("Are you sure you want to delete this event? This action cannot be undone!"))return;await h.cancelEvent(n)}catch{m.error("[canceling event]",error),d.error(error)}},async createTicket(){try{let n={eventId:l.activeEvent.id,accountId:l.account.id};await T.createTicket(n),this.event.capacity--}catch(n){m.error("[making ticket]",n),d.error(n)}},async removeTicket(){try{let n=l.tickets.find(i=>i.accountId==l.account.id);await T.removeTicket(n),this.event.capacity++}catch(n){m.error("[remove ticket]",n),d.error(n)}},async handleSubmit(){try{c.value.eventId=s.params.eventId,c.value.creatorId=this.account.id,await h.createComment(c.value),c.value={}}catch(n){m.error("[]",n),d.error(n)}},async deleteComment(n){try{if(!await d.confirm("Are you sure you want to delete this event? This action cannot be undone!"))return;await h.deleteComment(n),k()}catch(i){m.error("[deleting comment]",i),d.error(i)}}}}},S=()=>{q(s=>({"1519b6a8":s.cover}))},x=b.setup;b.setup=x?(s,c)=>(S(),x(s,c)):S;const O=b,p=s=>(j("data-v-8aaaf794"),s=s(),M(),s),Y={key:0},z={class:"container event-img"},G={class:"row"},H={class:"col-8 offset-1"},J={key:0,type:"button",class:"m-2 btn btn-primary col-1","data-bs-toggle":"modal","data-bs-target":"#create-event"},K={key:3,class:"bg-danger"},Q={key:4,class:"col-12 p-5 bg-danger text-center"},W=p(()=>t("h4",null,"Event Cancelled",-1)),X=[W],Z={class:"col-6 offset-1"},$={class:"elevation-2 p-2"},ee={class:"col-3 offset-1"},te={class:"elevation-2 p-2"},ne=f("Location:"),oe=f("Date:"),ce={class:"row justify-content-evenly"},ae={class:"col-6"},re=f("Seats Remaining:"),se={key:0},ie={class:"container"},le={class:"row bg-dark"},de={class:"col-12 d-flex p-2"},ve=["title","src"],me={class:"col-12 m-2"},_e=["src","title"],ue=p(()=>t("label",{for:"",class:"form-label"},"Comment Below:",-1)),he=p(()=>t("button",{type:"submit",class:"btn btn-primary rounded-pill"},"post",-1)),ye={class:"row"},ge={class:"card p-2 elevation-2"},ke={class:"col-2 d-flex align-items-center"},fe=["src","title"],be={class:"px-4 mt-3"},pe={class:"col-8 p-3"},we=["onClick"],Ce={key:1};function Te(s,c,w,e,k,n){const i=R("EventForm");return e.event?(r(),a("section",Y,[t("div",z,[t("div",G,[t("div",H,[t("p",null,[t("h1",null,_(e.event.name),1)])]),e.event.creatorId==e.account.id?(r(),a("button",J," Edit ")):v("",!0),e.event.creatorId==e.account.id&&e.event.isCanceled==!1?(r(),a("button",{key:1,type:"button",class:"m-2 btn btn-danger col-1",onClick:c[0]||(c[0]=o=>e.cancelEvent(`${e.event.id}`))}," Cancel ")):v("",!0),e.event.creatorId==e.account.id&&e.event.isCanceled==!0?(r(),a("button",{key:2,type:"button",class:"m-2 btn btn-danger col-1",onClick:c[1]||(c[1]=o=>e.cancelEvent(`${e.event.id}`))}," Un-Cancel ")):v("",!0),e.event.capacity<1?(r(),a("div",K,"SOLD OUT")):v("",!0),e.event.isCanceled?(r(),a("div",Q,X)):v("",!0),t("div",Z,[t("p",$,_(e.event.description),1)]),t("div",ee,[t("p",te,[t("div",null,[ne,t("h5",null,_(e.event.location),1)]),t("div",null,[oe,t("h5",null,_(new Date(e.event.startDate).toLocaleDateString("en-US",{month:"short",day:"2-digit"})),1)]),t("div",ce,[t("div",ae,[re,t("h5",null,_(e.event.capacity),1)]),e.hasTicket?v("",!0):(r(),a("button",{key:0,class:"btn btn-success col-4",onClick:c[2]||(c[2]=(...o)=>e.createTicket&&e.createTicket(...o))},"Claim Ticket")),e.hasTicket?(r(),a("button",{key:1,class:"btn btn-warning col-4",onClick:c[3]||(c[3]=(...o)=>e.removeTicket&&e.removeTicket(...o))},"Refund Ticket")):v("",!0)]),e.hasTicket?(r(),a("span",se,"You are attending this event")):v("",!0)])])])]),t("div",ie,[t("div",le,[t("div",de,[(r(!0),a(I,null,E(e.tickets,o=>{var y,g;return r(),a("div",{key:o.id},[t("img",{class:"profile-img m-1",title:(y=o.profile)==null?void 0:y.name,src:(g=o.profile)==null?void 0:g.picture,alt:"profile-img"},null,8,ve)])}),128))])]),t("div",me,[t("form",{class:"card p-3",onSubmit:c[5]||(c[5]=V((...o)=>e.handleSubmit&&e.handleSubmit(...o),["prevent"]))},[t("div",null,[t("img",{class:"profile-img",src:e.account.picture,alt:"profile-img",title:e.account.name},null,8,_e)]),ue,B(t("textarea",{type:"text",required:"","onUpdate:modelValue":c[4]||(c[4]=o=>e.editable.body=o),name:"comment",rows:"6"},null,512),[[F,e.editable.body]]),he],32)]),(r(!0),a(I,null,E(e.comments,o=>{var y,g,C;return r(),a("div",{key:o.id},[t("div",ye,[t("div",ge,[t("div",ke,[t("img",{class:"profile-img-lg",src:(y=o.creator)==null?void 0:y.picture,title:(g=o.creator)==null?void 0:g.name,alt:"profile-picture"},null,8,fe),t("p",be,_((C=o.creator)==null?void 0:C.name),1)]),t("div",pe,[t("p",null,_(o.body),1)]),o.creatorId==e.account.id?(r(),a("button",{key:0,class:"btn btn-danger",onClick:Ie=>e.deleteComment(o.id)},"delete comment",8,we)):v("",!0)])])])}),128))]),A(i)])):(r(),a("section",Ce,"loading..."))}const xe=D(O,[["render",Te],["__scopeId","data-v-8aaaf794"]]);export{xe as default};
